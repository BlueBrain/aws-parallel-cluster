Region: us-east-1
Image:
  Os: alinux2
  CustomAmi: ami-01df237b945ab7147
HeadNode:
  InstanceType: t3.micro
  Networking:
    SubnetId: subnet-076ece71c00742d3c # compute
    SecurityGroups:
    - sg-0b5941ba4f4d1a9ff # sbo-poc-compute / hpc
  Ssh:
    KeyName: aws_coreservices
  Iam:
    S3Access:
      - BucketName: sboinfrastructureassets
  CustomActions:
    OnNodeStart:
      Sequence:
        - Script: s3://sboinfrastructureassets/scripts/create_users.py
          Args:
            - /compute-efs/users.json
Scheduling:
  Scheduler: slurm
  SlurmQueues:
  - Name: debug # for testing purposes
    AllocationStrategy: lowest-price
    ComputeResources:
    - Name: t3micro
      Instances:
      - InstanceType: t3.micro
      MinCount: 0
      MaxCount: 8
    Networking:
      SubnetIds:
      - subnet-076ece71c00742d3c # compute
      SecurityGroups:
      - sg-0b5941ba4f4d1a9ff # sbo-poc-compute / hpc
    Iam:
      S3Access:
        - BucketName: sboinfrastructureassets
    CustomActions:
      OnNodeStart:
        Sequence:
          - Script: s3://sboinfrastructureassets/scripts/create_users.py
            Args:
              - /compute-efs/users.json
  - Name: prod # for benchmarking
    AllocationStrategy: lowest-price
    ComputeResources:
    - Name: cpu
      Instances:
      - InstanceType: c6i.metal # compute optimized nodes
      MinCount: 0
      MaxCount: 20 # upper limit for largest PoC case defined in cost estimation sheet
      Efa: # low-latency, high BW network
        Enabled: false # enable after security groups have been updated
                       # https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/efa-start.html#efa-start-security
    - Name: nvme
      Instances:
      - InstanceType: c6id.metal # provides additionally nvme support
      MinCount: 0
      MaxCount: 2 # upper limit for functionalizer use-case defined in cost estimation sheet
      Efa:
        Enabled: false
    Networking:
      PlacementGroup: # try to place nodes close to each other
        Enabled: false
      SubnetIds:
      - subnet-076ece71c00742d3c # compute
      SecurityGroups:
      - sg-0b5941ba4f4d1a9ff # sbo-poc-compute / hpc
    Iam:
      S3Access:
        - BucketName: sboinfrastructureassets
    CustomActions:
      OnNodeStart:
        Sequence:
          - Script: s3://sboinfrastructureassets/scripts/create_users.py
            Args:
              - /compute-efs/users.json
  SlurmSettings:
    EnableMemoryBasedScheduling: true
Imds:
  ImdsSupport: v2.0
SharedStorage:
  - Name: Efs0
    StorageType: Efs
    MountDir: /compute-efs
    EfsSettings:
      FileSystemId: fs-0c2a2f3ad1b1beeca # sbo-poc-compute
